<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>NEXUS v12 | DUAL CORE AI</title>
    <style>
        :root { --p: #00e1ff; --s: #ff00ff; --bg: #050505; --panel: #0a0a0a; --green: #00ff88; }
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body, html { margin: 0; padding: 0; background: var(--bg); color: #fff; height: 100vh; overflow: hidden; }

        /* Экранизация входа */
        #gate { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .gate-card { border: 2px solid var(--p); padding: 40px; background: var(--panel); text-align: center; box-shadow: 0 0 40px rgba(0,225,255,0.2); width: 400px; border-radius: 10px; }
        
        /* Главный макет */
        .app { display: flex; height: 100vh; flex-direction: column; }
        
        header { 
            padding: 15px 30px; border-bottom: 1px solid #222; background: #000;
            display: flex; justify-content: space-between; align-items: center;
        }

        .status-box { display: flex; gap: 20px; font-size: 12px; }
        .indicator { display: flex; align-items: center; gap: 5px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: #444; }
        .active-dot { background: var(--green); box-shadow: 0 0 10px var(--green); }

        /* Чат */
        #viewport { 
            flex-grow: 1; padding: 30px; overflow-y: auto; 
            background: linear-gradient(180deg, #050505 0%, #000 100%);
            scrollbar-width: thin; scrollbar-color: var(--p) #000;
        }

        .bubble { 
            margin-bottom: 30px; animation: fadeInUp 0.4s ease;
            max-width: 90%; border-radius: 10px;
        }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .ai-msg { border-left: 4px solid var(--p); background: rgba(0, 225, 255, 0.03); padding: 20px; }
        .user-msg { border-left: 4px solid var(--s); background: rgba(255, 0, 255, 0.03); padding: 20px; margin-left: auto; text-align: right; }

        .label { font-size: 10px; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; color: var(--p); font-weight: bold; }
        
        /* Код и ввод */
        pre { background: #000; padding: 20px; border: 1px solid #333; color: var(--green); overflow-x: auto; border-radius: 5px; text-align: left; }
        
        .control-bar { padding: 30px; background: #080808; border-top: 1px solid #222; display: flex; gap: 15px; }
        input { 
            flex-grow: 1; background: #000; border: 1px solid #333; color: #fff; 
            padding: 18px; border-radius: 8px; font-size: 16px; outline: none;
        }
        input:focus { border-color: var(--p); }

        .btn { 
            background: var(--p); color: #000; border: none; padding: 0 40px; 
            font-weight: bold; border-radius: 8px; cursor: pointer;
        }
        .btn:hover { box-shadow: 0 0 20px var(--p); }

        #engine-selector { background: #111; color: #fff; border: 1px solid #333; border-radius: 5px; padding: 0 10px; }
    </style>
</head>
<body>

<div id="gate">
    <div class="gate-card">
        <h1 style="color: var(--p); margin: 0 0 10px;">NEXUS CORE</h1>
        <p style="color: #555; font-size: 12px; margin-bottom: 30px;">DUAL AI PROTOCOL ACTIVATED</p>
        <input type="password" id="pass" placeholder="PASSWORD" style="width: 100%; text-align: center; margin-bottom: 20px;">
        <button onclick="boot()" class="btn" style="width: 100%; height: 50px;">INITIALIZE</button>
    </div>
</div>

<div class="app">
    <header>
        <div style="font-weight: bold; font-size: 18px; color: var(--p);">NEXUS <span style="color: #fff;">v12</span></div>
        <div class="status-box">
            <div class="indicator"><div id="d1" class="dot"></div> ENGINE_1: QWEN</div>
            <div class="indicator"><div id="d2" class="dot"></div> ENGINE_2: LLAMA</div>
        </div>
        <select id="engine-selector">
            <option value="qwen">CORE: QWEN (Luau Expert)</option>
            <option value="llama">CORE: LLAMA (Fast Logic)</option>
        </select>
    </header>

    <div id="viewport">
        <div class="bubble ai-msg">
            <div class="label">System</div>
            Привет, Создатель. Я подключил два независимых ядра ИИ. <br>
            Если один не отвечает, просто переключи <b>CORE</b> сверху.
        </div>
    </div>

    <div class="control-bar">
        <input type="text" id="input" placeholder="Опиши скрипт (например: 'Сделай систему инвентаря на GUI')..." onkeypress="if(event.key==='Enter') send()">
        <button class="btn" onclick="send()">RUN</button>
    </div>
</div>

<script>
    const TOKEN = "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";
    let isLogged = false;

    // Модели
    const ENGINES = {
        qwen: "https://api-inference.huggingface.co/models/Qwen/Qwen2.5-Coder-32B-Instruct",
        llama: "https://api-inference.huggingface.co/models/meta-llama/Llama-3.2-11B-Vision-Instruct"
    };

    function boot() {
        if(document.getElementById('pass').value.toUpperCase() === 'CREATOR') {
            document.getElementById('gate').style.display = 'none';
            isLogged = true;
            testEngines();
        } else { alert("ACCESS DENIED"); }
    }

    async function testEngines() {
        for(let key in ENGINES) {
            try {
                const res = await fetch(ENGINES[key], {
                    headers: { "Authorization": `Bearer ${TOKEN}` },
                    method: "POST", body: JSON.stringify({ inputs: "test" })
                });
                if(res.ok) document.getElementById(key === 'qwen' ? 'd1' : 'd2').classList.add('active-dot');
            } catch(e) {}
        }
    }

    async function send() {
        if(!isLogged) return;
        const inp = document.getElementById('input');
        const val = inp.value.trim();
        if(!val) return;

        addMsg("USER", val, "user-msg");
        inp.value = "";
        
        const loader = addMsg("NEXUS", "<i>[ГЕНЕРАЦИЯ ЧЕРЕЗ ВЫБРАННОЕ ЯДРО...]</i>", "ai-msg");
        const engine = document.getElementById('engine-selector').value;

        try {
            const response = await fetch(ENGINES[engine], {
                method: "POST",
                headers: { "Authorization": `Bearer ${TOKEN}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    inputs: `<|im_start|>system\nТы - лучший Roblox программист. Пиши огромные скрипты.<|im_end|>\n<|im_start|>user\n${val}<|im_end|>\n<|im_start|>assistant`,
                    parameters: { max_new_tokens: 2000, wait_for_model: true }
                })
            });

            const data = await response.json();
            loader.remove();

            if(data.error) {
                addMsg("ERROR", "Это ядро занято или просыпается. Попробуй переключить Core в меню сверху или подожди 20 сек.", "ai-msg");
            } else {
                let text = data[0].generated_text || data.generated_text || "Ошибка формата";
                if(text.includes('assistant')) text = text.split('assistant').pop();
                addMsg("NEXUS", text, "ai-msg");
            }
        } catch (e) {
            loader.remove();
            addMsg("ERROR", "Критический блок запроса. Убедись, что зашел через HTTPS на GitHub!", "ai-msg");
        }
    }

    function addMsg(who, txt, cls) {
        const view = document.getElementById('viewport');
        const d = document.createElement('div');
        d.className = "bubble " + cls;
        
        let html = txt.replace(/```lua([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                      .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                      .replace(/\n/g, '<br>');
        
        d.innerHTML = `<div class="label">${who}</div>${html}`;
        view.appendChild(d);
        view.scrollTop = view.scrollHeight;
        return d;
    }
</script>
</body>
</html>